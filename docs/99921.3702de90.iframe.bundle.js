"use strict";(self.webpackChunkghost_design_system=self.webpackChunkghost_design_system||[]).push([[99921],{"./node_modules/suneditor/src/plugins/dialog/image.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _modules_dialog__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/dialog.js"),_modules_dialog__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_modules_dialog__WEBPACK_IMPORTED_MODULE_0__),_modules_anchor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/_anchor.js"),_modules_component__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/component.js"),_modules_component__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_modules_component__WEBPACK_IMPORTED_MODULE_2__),_modules_resizing__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/resizing.js"),_modules_resizing__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_modules_resizing__WEBPACK_IMPORTED_MODULE_3__),_modules_fileManager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/fileManager.js"),_modules_fileManager__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_modules_fileManager__WEBPACK_IMPORTED_MODULE_4__);const __WEBPACK_DEFAULT_EXPORT__={name:"image",display:"dialog",add:function(core){core.addModule([_modules_dialog__WEBPACK_IMPORTED_MODULE_0___default(),_modules_anchor__WEBPACK_IMPORTED_MODULE_1__.Z,_modules_component__WEBPACK_IMPORTED_MODULE_2___default(),_modules_resizing__WEBPACK_IMPORTED_MODULE_3___default(),_modules_fileManager__WEBPACK_IMPORTED_MODULE_4___default()]);const options=core.options,context=core.context,contextImage=context.image={_infoList:[],_infoIndex:0,_uploadFileLength:0,focusElement:null,sizeUnit:options._imageSizeUnit,_linkElement:"",_altText:"",_align:"none",_floatClassRegExp:"__se__float\\-[a-z]+",_v_src:{_linkValue:""},svgDefaultSize:"30%",base64RenderIndex:0,_element:null,_cover:null,_container:null,inputX:null,inputY:null,_element_w:1,_element_h:1,_element_l:0,_element_t:0,_defaultSizeX:"auto",_defaultSizeY:"auto",_origin_w:"auto"===options.imageWidth?"":options.imageWidth,_origin_h:"auto"===options.imageHeight?"":options.imageHeight,_proportionChecked:!0,_resizing:options.imageResizing,_resizeDotHide:!options.imageHeightShow,_rotation:options.imageRotation,_alignHide:!options.imageAlignShow,_onlyPercentage:options.imageSizeOnlyPercentage,_ratio:!1,_ratioX:1,_ratioY:1,_captionShow:!0,_captionChecked:!1,_caption:null,captionCheckEl:null};let image_dialog=this.setDialog(core);contextImage.modal=image_dialog,contextImage.imgInputFile=image_dialog.querySelector("._se_image_file"),contextImage.imgUrlFile=image_dialog.querySelector("._se_image_url"),contextImage.focusElement=contextImage.imgInputFile||contextImage.imgUrlFile,contextImage.altText=image_dialog.querySelector("._se_image_alt"),contextImage.captionCheckEl=image_dialog.querySelector("._se_image_check_caption"),contextImage.previewSrc=image_dialog.querySelector("._se_tab_content_image .se-link-preview"),image_dialog.querySelector(".se-dialog-tabs").addEventListener("click",this.openTab.bind(core)),image_dialog.querySelector("form").addEventListener("submit",this.submit.bind(core)),contextImage.imgInputFile&&image_dialog.querySelector(".se-file-remove").addEventListener("click",this._removeSelectedFiles.bind(contextImage.imgInputFile,contextImage.imgUrlFile,contextImage.previewSrc)),contextImage.imgUrlFile&&contextImage.imgUrlFile.addEventListener("input",this._onLinkPreview.bind(contextImage.previewSrc,contextImage._v_src,options.linkProtocol)),contextImage.imgInputFile&&contextImage.imgUrlFile&&contextImage.imgInputFile.addEventListener("change",this._fileInputChange.bind(contextImage));const imageGalleryButton=image_dialog.querySelector(".__se__gallery");imageGalleryButton&&imageGalleryButton.addEventListener("click",this._openGallery.bind(core)),contextImage.proportion={},contextImage.inputX={},contextImage.inputY={},options.imageResizing&&(contextImage.proportion=image_dialog.querySelector("._se_image_check_proportion"),contextImage.inputX=image_dialog.querySelector("._se_image_size_x"),contextImage.inputY=image_dialog.querySelector("._se_image_size_y"),contextImage.inputX.value=options.imageWidth,contextImage.inputY.value=options.imageHeight,contextImage.inputX.addEventListener("keyup",this.setInputSize.bind(core,"x")),contextImage.inputY.addEventListener("keyup",this.setInputSize.bind(core,"y")),contextImage.inputX.addEventListener("change",this.setRatio.bind(core)),contextImage.inputY.addEventListener("change",this.setRatio.bind(core)),contextImage.proportion.addEventListener("change",this.setRatio.bind(core)),image_dialog.querySelector(".se-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(core))),context.dialog.modal.appendChild(image_dialog),core.plugins.anchor.initEvent.call(core,"image",image_dialog.querySelector("._se_tab_content_url")),contextImage.anchorCtx=core.context.anchor.caller.image,image_dialog=null},setDialog:function(core){const option=core.options,lang=core.lang,dialog=core.util.createElement("DIV");dialog.className="se-dialog-content se-dialog-image",dialog.style.display="none";let html='<div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" class="close" title="'+lang.dialogBox.close+'" aria-label="'+lang.dialogBox.close+'">'+core.icons.cancel+'</button><span class="se-modal-title">'+lang.dialogBox.imageBox.title+'</span></div><div class="se-dialog-tabs"><button type="button" class="_se_tab_link active" data-tab-link="image">'+lang.toolbar.image+'</button><button type="button" class="_se_tab_link" data-tab-link="url">'+lang.toolbar.link+'</button></div><form method="post" enctype="multipart/form-data"><div class="_se_tab_content _se_tab_content_image"><div class="se-dialog-body"><div style="border-bottom: 1px dashed #ccc;">';if(option.imageFileInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.imageBox.file+'</label><div class="se-dialog-form-files"><input class="se-input-form _se_image_file" type="file" accept="'+option.imageAccept+'"'+(option.imageMultipleFile?' multiple="multiple"':"")+'/><button type="button" class="se-btn se-dialog-files-edge-button se-file-remove" title="'+lang.controller.remove+'" aria-label="'+lang.controller.remove+'">'+core.icons.cancel+"</button></div></div>"),option.imageUrlInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.imageBox.url+'</label><div class="se-dialog-form-files"><input class="se-input-form se-input-url _se_image_url" type="text" />'+(option.imageGalleryUrl&&core.plugins.imageGallery?'<button type="button" class="se-btn se-dialog-files-edge-button __se__gallery" title="'+lang.toolbar.imageGallery+'" aria-label="'+lang.toolbar.imageGallery+'">'+core.icons.image_gallery+"</button>":"")+'</div><pre class="se-link-preview"></pre></div>'),html+='</div><div class="se-dialog-form"><label>'+lang.dialogBox.imageBox.altText+'</label><input class="se-input-form _se_image_alt" type="text" /></div>',option.imageResizing){const onlyPercentage=option.imageSizeOnlyPercentage,onlyPercentDisplay=onlyPercentage?' style="display: none !important;"':"",heightDisplay=option.imageHeightShow?"":' style="display: none !important;"';html+='<div class="se-dialog-form">',onlyPercentage||!option.imageHeightShow?html+='<div class="se-dialog-size-text"><label class="size-w">'+lang.dialogBox.size+"</label></div>":html+='<div class="se-dialog-size-text"><label class="size-w">'+lang.dialogBox.width+'</label><label class="se-dialog-size-x">&nbsp;</label><label class="size-h">'+lang.dialogBox.height+"</label></div>",html+='<input class="se-input-control _se_image_size_x" placeholder="auto"'+(onlyPercentage?' type="number" min="1"':'type="text"')+(onlyPercentage?' max="100"':"")+' /><label class="se-dialog-size-x"'+heightDisplay+">"+(onlyPercentage?"%":"x")+'</label><input type="text" class="se-input-control _se_image_size_y" placeholder="auto"'+onlyPercentDisplay+(onlyPercentage?' max="100"':"")+heightDisplay+"/><label"+onlyPercentDisplay+heightDisplay+'><input type="checkbox" class="se-dialog-btn-check _se_image_check_proportion" checked/>&nbsp;'+lang.dialogBox.proportion+'</label><button type="button" title="'+lang.dialogBox.revertButton+'" aria-label="'+lang.dialogBox.revertButton+'" class="se-btn se-dialog-btn-revert" style="float: right;">'+core.icons.revert+"</button></div>"}return html+='<div class="se-dialog-form se-dialog-form-footer"><label><input type="checkbox" class="se-dialog-btn-check _se_image_check_caption" />&nbsp;'+lang.dialogBox.caption+'</label></div></div></div><div class="_se_tab_content _se_tab_content_url" style="display: none">'+core.context.anchor.forms.innerHTML+'</div><div class="se-dialog-footer"><div'+(option.imageAlignShow?"":' style="display: none"')+'><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="none" checked>'+lang.dialogBox.basic+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="left">'+lang.dialogBox.left+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="center">'+lang.dialogBox.center+'</label><label><input type="radio" name="suneditor_image_radio" class="se-dialog-btn-radio" value="right">'+lang.dialogBox.right+'</label></div><button type="submit" class="se-btn-primary" title="'+lang.dialogBox.submitButton+'" aria-label="'+lang.dialogBox.submitButton+'"><span>'+lang.dialogBox.submitButton+"</span></button></div></form>",dialog.innerHTML=html,dialog},_fileInputChange:function(){this.imgInputFile.value?(this.imgUrlFile.setAttribute("disabled",!0),this.previewSrc.style.textDecoration="line-through"):(this.imgUrlFile.removeAttribute("disabled"),this.previewSrc.style.textDecoration="")},_removeSelectedFiles:function(urlInput,previewSrc){this.value="",urlInput&&(urlInput.removeAttribute("disabled"),previewSrc.style.textDecoration="")},_openGallery:function(){this.callPlugin("imageGallery",this.plugins.imageGallery.open.bind(this,this.plugins.image._setUrlInput.bind(this.context.image)),null)},_setUrlInput:function(target){this.altText.value=target.alt,this._v_src._linkValue=this.previewSrc.textContent=this.imgUrlFile.value=target.src,this.imgUrlFile.focus()},_onLinkPreview:function(context,protocol,e){const value=e.target.value.trim();context._linkValue=this.textContent=value?protocol&&-1===value.indexOf("://")&&0!==value.indexOf("#")?protocol+value:-1===value.indexOf("://")?"/"+value:value:""},fileTags:["img"],select:function(element){this.plugins.image.onModifyMode.call(this,element,this.plugins.resizing.call_controller_resize.call(this,element,"image"))},destroy:function(element){const imageEl=element||this.context.image._element,imageContainer=this.util.getParentElement(imageEl,this.util.isMediaComponent)||imageEl,dataIndex=1*imageEl.getAttribute("data-index");let focusEl=imageContainer.previousElementSibling||imageContainer.nextElementSibling;const emptyDiv=imageContainer.parentNode;this.util.removeItem(imageContainer),this.plugins.image.init.call(this),this.controllersOff(),emptyDiv!==this.context.element.wysiwyg&&this.util.removeItemAllParents(emptyDiv,(function(current){return 0===current.childNodes.length}),null),this.focusEdge(focusEl),this.plugins.fileManager.deleteInfo.call(this,"image",dataIndex,this.functions.onImageUpload),this.history.push(!1)},on:function(update){const contextImage=this.context.image;update?contextImage.imgInputFile&&this.options.imageMultipleFile&&contextImage.imgInputFile.removeAttribute("multiple"):(contextImage.inputX.value=contextImage._origin_w=this.options.imageWidth===contextImage._defaultSizeX?"":this.options.imageWidth,contextImage.inputY.value=contextImage._origin_h=this.options.imageHeight===contextImage._defaultSizeY?"":this.options.imageHeight,contextImage.imgInputFile&&this.options.imageMultipleFile&&contextImage.imgInputFile.setAttribute("multiple","multiple")),this.plugins.anchor.on.call(this,contextImage.anchorCtx,update)},open:function(){this.plugins.dialog.open.call(this,"image","image"===this.currentControllerName)},openTab:function(e){const modal=this.context.image.modal,targetElement="init"===e?modal.querySelector("._se_tab_link"):e.target;if(!/^BUTTON$/i.test(targetElement.tagName))return!1;const tabName=targetElement.getAttribute("data-tab-link");let i,tabContent,tabLinks;for(tabContent=modal.getElementsByClassName("_se_tab_content"),i=0;i<tabContent.length;i++)tabContent[i].style.display="none";for(tabLinks=modal.getElementsByClassName("_se_tab_link"),i=0;i<tabLinks.length;i++)this.util.removeClass(tabLinks[i],"active");return modal.querySelector("._se_tab_content_"+tabName).style.display="block",this.util.addClass(targetElement,"active"),"image"===tabName&&this.context.image.focusElement?this.context.image.focusElement.focus():"url"===tabName&&this.context.anchor.caller.image.urlInput.focus(),!1},submit:function(e){const contextImage=this.context.image,imagePlugin=this.plugins.image;e.preventDefault(),e.stopPropagation(),contextImage._altText=contextImage.altText.value,contextImage._align=contextImage.modal.querySelector('input[name="suneditor_image_radio"]:checked').value,contextImage._captionChecked=contextImage.captionCheckEl.checked,contextImage._resizing&&(contextImage._proportionChecked=contextImage.proportion.checked);try{this.context.dialog.updateModal&&imagePlugin.update_image.call(this,!1,!0,!1),contextImage.imgInputFile&&contextImage.imgInputFile.files.length>0?(this.showLoading(),imagePlugin.submitAction.call(this,this.context.image.imgInputFile.files)):contextImage.imgUrlFile&&contextImage._v_src._linkValue.length>0&&(this.showLoading(),imagePlugin.onRender_imgUrl.call(this,contextImage._v_src._linkValue))}catch(error){throw this.closeLoading(),Error('[SUNEDITOR.image.submit.fail] cause : "'+error.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(fileList){if(0===fileList.length)return;let fileSize=0,files=[];for(let i=0,len=fileList.length;i<len;i++)/image/i.test(fileList[i].type)&&(files.push(fileList[i]),fileSize+=fileList[i].size);const limitSize=this.options.imageUploadSizeLimit;if(limitSize>0){let infoSize=0;const imagesInfo=this.context.image._infoList;for(let i=0,len=imagesInfo.length;i<len;i++)infoSize+=1*imagesInfo[i].size;if(fileSize+infoSize>limitSize){this.closeLoading();const err="[SUNEDITOR.imageUpload.fail] Size of uploadable total images: "+limitSize/1e3+"KB";return void(("function"!=typeof this.functions.onImageUploadError||this.functions.onImageUploadError(err,{limitSize,currentSize:infoSize,uploadSize:fileSize},this))&&this.functions.noticeOpen(err))}}const contextImage=this.context.image;contextImage._uploadFileLength=files.length;const info={anchor:this.plugins.anchor.createAnchor.call(this,contextImage.anchorCtx,!0),inputWidth:contextImage.inputX.value,inputHeight:contextImage.inputY.value,align:contextImage._align,isUpdate:this.context.dialog.updateModal,alt:contextImage._altText,element:contextImage._element};if("function"==typeof this.functions.onImageUploadBefore){const result=this.functions.onImageUploadBefore(files,info,this,function(data){data&&this._w.Array.isArray(data.result)?this.plugins.image.register.call(this,info,data):this.plugins.image.upload.call(this,info,data)}.bind(this));if(void 0===result)return;if(!result)return void this.closeLoading();this._w.Array.isArray(result)&&result.length>0&&(files=result)}this.plugins.image.upload.call(this,info,files)},error:function(message,response){if(this.closeLoading(),"function"!=typeof this.functions.onImageUploadError||this.functions.onImageUploadError(message,response,this))throw this.functions.noticeOpen(message),Error("[SUNEDITOR.plugin.image.error] response: "+message)},upload:function(info,files){if(!files)return void this.closeLoading();if("string"==typeof files)return void this.plugins.image.error.call(this,files,null);const imageUploadUrl=this.options.imageUploadUrl,filesLen=this.context.dialog.updateModal?1:files.length;if("string"==typeof imageUploadUrl&&imageUploadUrl.length>0){const formData=new FormData;for(let i=0;i<filesLen;i++)formData.append("file-"+i,files[i]);this.plugins.fileManager.upload.call(this,imageUploadUrl,this.options.imageUploadHeader,formData,this.plugins.image.callBack_imgUpload.bind(this,info),this.functions.onImageUploadError)}else this.plugins.image.setup_reader.call(this,files,info.anchor,info.inputWidth,info.inputHeight,info.align,info.alt,filesLen,info.isUpdate)},callBack_imgUpload:function(info,xmlHttp){if("function"==typeof this.functions.imageUploadHandler)this.functions.imageUploadHandler(xmlHttp,info,this);else{const response=JSON.parse(xmlHttp.responseText);response.errorMessage?this.plugins.image.error.call(this,response.errorMessage,response):this.plugins.image.register.call(this,info,response)}},register:function(info,response){const fileList=response.result;for(let file,i=0,len=fileList.length;i<len;i++){if(file={name:fileList[i].name,size:fileList[i].size},info.isUpdate){this.plugins.image.update_src.call(this,fileList[i].url,info.element,file);break}this.plugins.image.create_image.call(this,fileList[i].url,info.anchor,info.inputWidth,info.inputHeight,info.align,file,info.alt)}this.closeLoading()},setup_reader:function(files,anchor,width,height,align,alt,filesLen,isUpdate){try{this.context.image.base64RenderIndex=filesLen;const wFileReader=this._w.FileReader,filesStack=[filesLen];this.context.image.inputX.value=width,this.context.image.inputY.value=height;for(let reader,file,i=0;i<filesLen;i++)reader=new wFileReader,file=files[i],reader.onload=function(reader,update,updateElement,file,index){filesStack[index]={result:reader.result,file},0==--this.context.image.base64RenderIndex&&(this.plugins.image.onRender_imgBase64.call(this,update,filesStack,updateElement,anchor,width,height,align,alt),this.closeLoading())}.bind(this,reader,isUpdate,this.context.image._element,file,i),reader.readAsDataURL(file)}catch(e){throw this.closeLoading(),Error('[SUNEDITOR.image.setup_reader.fail] cause : "'+e.message+'"')}},onRender_imgBase64:function(update,filesStack,updateElement,anchor,width,height,align,alt){const updateMethod=this.plugins.image.update_src,createMethod=this.plugins.image.create_image;for(let i=0,len=filesStack.length;i<len;i++)update?(this.context.image._element.setAttribute("data-file-name",filesStack[i].file.name),this.context.image._element.setAttribute("data-file-size",filesStack[i].file.size),updateMethod.call(this,filesStack[i].result,updateElement,filesStack[i].file)):createMethod.call(this,filesStack[i].result,anchor,width,height,align,filesStack[i].file,alt)},onRender_imgUrl:function(url){if(url||(url=this.context.image._v_src._linkValue),!url)return!1;const contextImage=this.context.image;try{const file={name:url.split("/").pop(),size:0};this.context.dialog.updateModal?this.plugins.image.update_src.call(this,url,contextImage._element,file):this.plugins.image.create_image.call(this,url,this.plugins.anchor.createAnchor.call(this,contextImage.anchorCtx,!0),contextImage.inputX.value,contextImage.inputY.value,contextImage._align,file,contextImage._altText)}catch(e){throw Error('[SUNEDITOR.image.URLRendering.fail] cause : "'+e.message+'"')}finally{this.closeLoading()}},onRender_link:function(imgTag,anchor){return anchor?(anchor.setAttribute("data-image-link","image"),imgTag.setAttribute("data-image-link",anchor.href),anchor.appendChild(imgTag),anchor):imgTag},setInputSize:function(xy,e){e&&32===e.keyCode?e.preventDefault():this.plugins.resizing._module_setInputSize.call(this,this.context.image,xy)},setRatio:function(){this.plugins.resizing._module_setRatio.call(this,this.context.image)},checkFileInfo:function(){const imagePlugin=this.plugins.image,contextImage=this.context.image,modifyHandler=function(tag){imagePlugin.onModifyMode.call(this,tag,null),imagePlugin.openModify.call(this,!0),contextImage.inputX.value=contextImage._origin_w,contextImage.inputY.value=contextImage._origin_h;const format=this.util.getFormatElement(tag);format&&(contextImage._align=format.style.textAlign||format.style.float),this.util.isAnchor(tag.parentNode)&&!contextImage.anchorCtx.linkValue&&(contextImage.anchorCtx.linkValue=" "),imagePlugin.update_image.call(this,!0,!1,!0),imagePlugin.init.call(this)}.bind(this);this.plugins.fileManager.checkInfo.call(this,"image",["img"],this.functions.onImageUpload,modifyHandler,!0)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"image",this.functions.onImageUpload)},create_image:function(src,anchor,width,height,align,file,alt){const imagePlugin=this.plugins.image,contextImage=this.context.image;this.context.resizing._resize_plugin="image";let oImg=this.util.createElement("IMG");oImg.src=src,oImg.alt=alt,oImg.setAttribute("data-rotate","0"),anchor=imagePlugin.onRender_link.call(this,oImg,anchor?anchor.cloneNode(!1):null),contextImage._resizing&&oImg.setAttribute("data-proportion",contextImage._proportionChecked);const cover=this.plugins.component.set_cover.call(this,anchor),container=this.plugins.component.set_container.call(this,cover,"se-image-container");contextImage._captionChecked&&(contextImage._caption=this.plugins.component.create_caption.call(this),contextImage._caption.setAttribute("contenteditable",!1),cover.appendChild(contextImage._caption)),contextImage._element=oImg,contextImage._cover=cover,contextImage._container=container,imagePlugin.applySize.call(this,width,height),imagePlugin.setAlign.call(this,align,oImg,cover,container),oImg.onload=imagePlugin._image_create_onload.bind(this,oImg,contextImage.svgDefaultSize,container),this.insertComponent(container,!0,!0,!0)&&this.plugins.fileManager.setInfo.call(this,"image",oImg,this.functions.onImageUpload,file,!0),this.context.resizing._resize_plugin=""},_image_create_onload:function(oImg,svgDefaultSize,container){if(0===oImg.offsetWidth&&this.plugins.image.applySize.call(this,svgDefaultSize,""),this.options.mediaAutoSelect)this.selectComponent(oImg,"image");else{const line=this.appendFormatTag(container,null);line&&this.setRange(line,0,line,0)}},update_image:function(init,openController,notHistoryPush){const contextImage=this.context.image;let changeSize,imageEl=contextImage._element,cover=contextImage._cover,container=contextImage._container,isNewContainer=!1;null===cover&&(isNewContainer=!0,imageEl=contextImage._element.cloneNode(!0),cover=this.plugins.component.set_cover.call(this,imageEl)),null===container?(cover=cover.cloneNode(!0),imageEl=cover.querySelector("img"),isNewContainer=!0,container=this.plugins.component.set_container.call(this,cover,"se-image-container")):isNewContainer&&(container.innerHTML="",container.appendChild(cover),contextImage._cover=cover,contextImage._element=imageEl,isNewContainer=!1);const x=this.util.isNumber(contextImage.inputX.value)?contextImage.inputX.value+contextImage.sizeUnit:contextImage.inputX.value,y=this.util.isNumber(contextImage.inputY.value)?contextImage.inputY.value+contextImage.sizeUnit:contextImage.inputY.value;changeSize=/%$/.test(imageEl.style.width)?x!==container.style.width||y!==container.style.height:x!==imageEl.style.width||y!==imageEl.style.height,imageEl.alt=contextImage._altText;let modifiedCaption=!1;contextImage._captionChecked?contextImage._caption||(contextImage._caption=this.plugins.component.create_caption.call(this),cover.appendChild(contextImage._caption),modifiedCaption=!0):contextImage._caption&&(this.util.removeItem(contextImage._caption),contextImage._caption=null,modifiedCaption=!0);let isNewAnchor=null;const anchor=this.plugins.anchor.createAnchor.call(this,contextImage.anchorCtx,!0);if(anchor)contextImage._linkElement!==anchor||isNewContainer&&!container.contains(anchor)?(contextImage._linkElement=anchor.cloneNode(!1),cover.insertBefore(this.plugins.image.onRender_link.call(this,imageEl,contextImage._linkElement),contextImage._caption),isNewAnchor=contextImage._element):contextImage._linkElement.setAttribute("data-image-link","image");else if(null!==contextImage._linkElement){const imageElement=imageEl;if(imageElement.setAttribute("data-image-link",""),cover.contains(contextImage._linkElement)){const newEl=imageElement.cloneNode(!0);cover.removeChild(contextImage._linkElement),cover.insertBefore(newEl,contextImage._caption),contextImage._element=imageEl=newEl}}let existElement=null;if(isNewContainer){if(existElement=this.util.isRangeFormatElement(contextImage._element.parentNode)||this.util.isWysiwygDiv(contextImage._element.parentNode)?contextImage._element:this.util.isAnchor(contextImage._element.parentNode)?contextImage._element.parentNode:this.util.getFormatElement(contextImage._element)||contextImage._element,this.util.getParentElement(contextImage._element,this.util.isNotCheckingNode))existElement=isNewAnchor?anchor:contextImage._element,existElement.parentNode.replaceChild(container,existElement);else if(this.util.isListCell(existElement)){const refer=this.util.getParentElement(contextImage._element,(function(current){return current.parentNode===existElement}));existElement.insertBefore(container,refer),this.util.removeItem(contextImage._element),this.util.removeEmptyNode(refer,null,!0)}else if(this.util.isFormatElement(existElement)){const refer=this.util.getParentElement(contextImage._element,(function(current){return current.parentNode===existElement}));existElement=this.util.splitElement(existElement,refer),existElement.parentNode.insertBefore(container,existElement),this.util.removeItem(contextImage._element),this.util.removeEmptyNode(existElement,null,!0),0===existElement.children.length&&(existElement.innerHTML=this.util.htmlRemoveWhiteSpace(existElement.innerHTML))}else if(this.util.isFormatElement(existElement.parentNode)){const formats=existElement.parentNode;formats.parentNode.insertBefore(container,existElement.previousSibling?formats.nextElementSibling:formats),0===contextImage.__updateTags.map((function(current){return existElement.contains(current)})).length&&this.util.removeItem(existElement)}else existElement.parentNode.replaceChild(container,existElement);imageEl=container.querySelector("img"),contextImage._element=imageEl,contextImage._cover=cover,contextImage._container=container}isNewAnchor&&(isNewContainer?(this.util.removeItem(isNewAnchor),0===this.util.getListChildren(anchor,(function(current){return/IMG/i.test(current.tagName)})).length&&this.util.removeItem(anchor)):this.util.removeItem(anchor)),(modifiedCaption||!contextImage._onlyPercentage&&changeSize)&&!init&&(/\d+/.test(imageEl.style.height)||this.context.resizing._rotateVertical&&contextImage._captionChecked)&&(/%$/.test(contextImage.inputX.value)||/%$/.test(contextImage.inputY.value)?this.plugins.resizing.resetTransform.call(this,imageEl):this.plugins.resizing.setTransformSize.call(this,imageEl,this.util.getNumber(contextImage.inputX.value,0),this.util.getNumber(contextImage.inputY.value,0))),contextImage._resizing&&(imageEl.setAttribute("data-proportion",contextImage._proportionChecked),changeSize&&this.plugins.image.applySize.call(this)),this.plugins.image.setAlign.call(this,null,imageEl,null,null),init&&this.plugins.fileManager.setInfo.call(this,"image",imageEl,this.functions.onImageUpload,null,!0),openController&&this.selectComponent(imageEl,"image"),notHistoryPush||this.history.push(!1)},update_src:function(src,element,file){element.src=src,this._w.setTimeout(this.plugins.fileManager.setInfo.bind(this,"image",element,this.functions.onImageUpload,file,!0)),this.selectComponent(element,"image")},onModifyMode:function(element,size){if(!element)return;const contextImage=this.context.image;contextImage._linkElement=contextImage.anchorCtx.linkAnchor=this.util.isAnchor(element.parentNode)?element.parentNode:null,contextImage._element=element,contextImage._cover=this.util.getParentElement(element,"FIGURE"),contextImage._container=this.util.getParentElement(element,this.util.isMediaComponent),contextImage._caption=this.util.getChildElement(contextImage._cover,"FIGCAPTION"),contextImage._align=element.style.float||element.getAttribute("data-align")||"none",element.style.float="",this.plugins.anchor.setCtx(contextImage._linkElement,contextImage.anchorCtx),size&&(contextImage._element_w=size.w,contextImage._element_h=size.h,contextImage._element_t=size.t,contextImage._element_l=size.l);let w,h,userSize=contextImage._element.getAttribute("data-size")||contextImage._element.getAttribute("data-origin");userSize?(userSize=userSize.split(","),w=userSize[0],h=userSize[1]):size&&(w=size.w,h=size.h),contextImage._origin_w=w||element.style.width||element.width||"",contextImage._origin_h=h||element.style.height||element.height||""},openModify:function(notOpen){const contextImage=this.context.image;contextImage.imgUrlFile&&(contextImage._v_src._linkValue=contextImage.previewSrc.textContent=contextImage.imgUrlFile.value=contextImage._element.src),contextImage._altText=contextImage.altText.value=contextImage._element.alt,(contextImage.modal.querySelector('input[name="suneditor_image_radio"][value="'+contextImage._align+'"]')||contextImage.modal.querySelector('input[name="suneditor_image_radio"][value="none"]')).checked=!0,contextImage._align=contextImage.modal.querySelector('input[name="suneditor_image_radio"]:checked').value,contextImage._captionChecked=contextImage.captionCheckEl.checked=!!contextImage._caption,contextImage._resizing&&this.plugins.resizing._module_setModifyInputSize.call(this,contextImage,this.plugins.image),notOpen||this.plugins.dialog.open.call(this,"image",!0)},applySize:function(w,h){const contextImage=this.context.image;return w||(w=contextImage.inputX.value||this.options.imageWidth),h||(h=contextImage.inputY.value||this.options.imageHeight),contextImage._onlyPercentage&&w||/%$/.test(w)?(this.plugins.image.setPercentSize.call(this,w,h),!0):(w&&"auto"!==w||h&&"auto"!==h?this.plugins.image.setSize.call(this,w,h,!1):this.plugins.image.setAutoSize.call(this),!1)},sizeRevert:function(){this.plugins.resizing._module_sizeRevert.call(this,this.context.image)},setSize:function(w,h,notResetPercentage,direction){const contextImage=this.context.image,onlyW=/^(rw|lw)$/.test(direction)&&/\d+/.test(contextImage._element.style.height);/^(th|bh)$/.test(direction)&&/\d+/.test(contextImage._element.style.width)||(contextImage._element.style.width=this.util.isNumber(w)?w+contextImage.sizeUnit:w,this.plugins.image.cancelPercentAttr.call(this)),onlyW||(contextImage._element.style.height=this.util.isNumber(h)?h+contextImage.sizeUnit:/%$/.test(h)?"":h),"center"===contextImage._align&&this.plugins.image.setAlign.call(this,null,null,null,null),notResetPercentage||contextImage._element.removeAttribute("data-percentage"),this.plugins.resizing._module_saveCurrentSize.call(this,contextImage)},setAutoSize:function(){const contextImage=this.context.image;contextImage._caption&&(contextImage._caption.style.marginTop=""),this.plugins.resizing.resetTransform.call(this,contextImage._element),this.plugins.image.cancelPercentAttr.call(this),contextImage._element.style.maxWidth="",contextImage._element.style.width="",contextImage._element.style.height="",contextImage._cover.style.width="",contextImage._cover.style.height="",this.plugins.image.setAlign.call(this,null,null,null,null),contextImage._element.setAttribute("data-percentage","auto,auto"),this.plugins.resizing._module_saveCurrentSize.call(this,contextImage)},setOriginSize:function(){const contextImage=this.context.image;contextImage._element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,contextImage._element),this.plugins.image.cancelPercentAttr.call(this);const originSize=(contextImage._element.getAttribute("data-origin")||"").split(","),w=originSize[0],h=originSize[1];originSize&&(contextImage._onlyPercentage||/%$/.test(w)&&(/%$/.test(h)||!/\d/.test(h))?this.plugins.image.setPercentSize.call(this,w,h):this.plugins.image.setSize.call(this,w,h),this.plugins.resizing._module_saveCurrentSize.call(this,contextImage))},setPercentSize:function(w,h){const contextImage=this.context.image;h=!h||/%$/.test(h)||this.util.getNumber(h,0)?this.util.isNumber(h)?h+contextImage.sizeUnit:h||"":this.util.isNumber(h)?h+"%":h;const heightPercentage=/%$/.test(h);contextImage._container.style.width=this.util.isNumber(w)?w+"%":w,contextImage._container.style.height="",contextImage._cover.style.width="100%",contextImage._cover.style.height=heightPercentage?h:"",contextImage._element.style.width="100%",contextImage._element.style.height=heightPercentage?"":h,contextImage._element.style.maxWidth="","center"===contextImage._align&&this.plugins.image.setAlign.call(this,null,null,null,null),contextImage._element.setAttribute("data-percentage",w+","+h),this.plugins.resizing.setCaptionPosition.call(this,contextImage._element),this.plugins.resizing._module_saveCurrentSize.call(this,contextImage)},cancelPercentAttr:function(){const contextImage=this.context.image;contextImage._cover.style.width="",contextImage._cover.style.height="",contextImage._container.style.width="",contextImage._container.style.height="",this.util.removeClass(contextImage._container,this.context.image._floatClassRegExp),this.util.addClass(contextImage._container,"__se__float-"+contextImage._align),"center"===contextImage._align&&this.plugins.image.setAlign.call(this,null,null,null,null)},setAlign:function(align,element,cover,container){const contextImage=this.context.image;align||(align=contextImage._align),element||(element=contextImage._element),cover||(cover=contextImage._cover),container||(container=contextImage._container),cover.style.margin=align&&"none"!==align?"auto":"0",/%$/.test(element.style.width)&&"center"===align?(container.style.minWidth="100%",cover.style.width=container.style.width):(container.style.minWidth="",cover.style.width=this.context.resizing._rotateVertical?element.style.height||element.offsetHeight:element.style.width&&"auto"!==element.style.width?element.style.width||"100%":""),this.util.hasClass(container,"__se__float-"+align)||(this.util.removeClass(container,contextImage._floatClassRegExp),this.util.addClass(container,"__se__float-"+align)),element.setAttribute("data-align",align)},init:function(){const contextImage=this.context.image;contextImage.imgInputFile&&(contextImage.imgInputFile.value=""),contextImage.imgUrlFile&&(contextImage._v_src._linkValue=contextImage.previewSrc.textContent=contextImage.imgUrlFile.value=""),contextImage.imgInputFile&&contextImage.imgUrlFile&&(contextImage.imgUrlFile.removeAttribute("disabled"),contextImage.previewSrc.style.textDecoration=""),contextImage.altText.value="",contextImage.modal.querySelector('input[name="suneditor_image_radio"][value="none"]').checked=!0,contextImage.captionCheckEl.checked=!1,contextImage._element=null,this.plugins.image.openTab.call(this,"init"),contextImage._resizing&&(contextImage.inputX.value=this.options.imageWidth===contextImage._defaultSizeX?"":this.options.imageWidth,contextImage.inputY.value=this.options.imageHeight===contextImage._defaultSizeY?"":this.options.imageHeight,contextImage.proportion.checked=!0,contextImage._ratio=!1,contextImage._ratioX=1,contextImage._ratioY=1),this.plugins.anchor.init.call(this,contextImage.anchorCtx)}}},"./node_modules/suneditor/src/plugins/dialog/link.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _modules_dialog__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/dialog.js"),_modules_dialog__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_modules_dialog__WEBPACK_IMPORTED_MODULE_0__),_modules_anchor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/suneditor/src/plugins/modules/_anchor.js");const __WEBPACK_DEFAULT_EXPORT__={name:"link",display:"dialog",add:function(core){core.addModule([_modules_dialog__WEBPACK_IMPORTED_MODULE_0___default(),_modules_anchor__WEBPACK_IMPORTED_MODULE_1__.Z]);const context=core.context,contextLink=context.link={focusElement:null,_linkAnchor:null,anchorCtx:null};let link_dialog=this.setDialog(core);contextLink.modal=link_dialog;let link_controller=this.setController_LinkButton(core);contextLink.linkController=link_controller,link_dialog.querySelector("form").addEventListener("submit",this.submit.bind(core)),link_controller.addEventListener("click",this.onClick_linkController.bind(core)),context.dialog.modal.appendChild(link_dialog),context.element.relative.appendChild(link_controller),core.plugins.anchor.initEvent.call(core,"link",link_dialog),contextLink.focusElement=context.anchor.caller.link.urlInput,link_dialog=null,link_controller=null},setDialog:function(core){const lang=core.lang,dialog=core.util.createElement("DIV"),icons=core.icons;dialog.className="se-dialog-content",dialog.style.display="none";let html='<form><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" title="'+lang.dialogBox.close+'" aria-label="'+lang.dialogBox.close+'">'+icons.cancel+'</button><span class="se-modal-title">'+lang.dialogBox.linkBox.title+"</span></div>"+core.context.anchor.forms.innerHTML+'<div class="se-dialog-footer"><button type="submit" class="se-btn-primary" title="'+lang.dialogBox.submitButton+'" aria-label="'+lang.dialogBox.submitButton+'"><span>'+lang.dialogBox.submitButton+"</span></button></div></form>";return dialog.innerHTML=html,dialog},setController_LinkButton:function(core){const lang=core.lang,icons=core.icons,link_btn=core.util.createElement("DIV");return link_btn.className="se-controller se-controller-link",link_btn.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="link-content"><span><a target="_blank" href=""></a>&nbsp;</span><div class="se-btn-group"><button type="button" data-command="update" tabindex="-1" class="se-btn se-tooltip">'+icons.edit+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.edit+'</span></span></button><button type="button" data-command="unlink" tabindex="-1" class="se-btn se-tooltip">'+icons.unlink+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.unlink+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="se-btn se-tooltip">'+icons.delete+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.remove+"</span></span></button></div></div>",link_btn},open:function(){this.plugins.dialog.open.call(this,"link","link"===this.currentControllerName)},submit:function(e){this.showLoading(),e.preventDefault(),e.stopPropagation();try{const oA=this.plugins.anchor.createAnchor.call(this,this.context.anchor.caller.link,!1);if(null===oA)return;if(this.context.dialog.updateModal){const textNode=this.context.link._linkAnchor.childNodes[0];this.setRange(textNode,0,textNode,textNode.textContent.length)}else{const selectedFormats=this.getSelectedElements();if(selectedFormats.length>1){const oFormat=this.util.createElement(selectedFormats[0].nodeName);if(oFormat.appendChild(oA),!this.insertNode(oFormat,null,!0))return}else if(!this.insertNode(oA,null,!0))return;this.setRange(oA.childNodes[0],0,oA.childNodes[0],oA.textContent.length)}}finally{this.plugins.dialog.close.call(this),this.closeLoading(),this.history.push(!1)}return!1},active:function(element){if(element){if(this.util.isAnchor(element)&&null===element.getAttribute("data-image-link"))return this.controllerArray.indexOf(this.context.link.linkController)<0&&this.plugins.link.call_controller.call(this,element),!0}else this.controllerArray.indexOf(this.context.link.linkController)>-1&&this.controllersOff();return!1},on:function(update){this.plugins.anchor.on.call(this,this.context.anchor.caller.link,update)},call_controller:function(selectionATag){this.editLink=this.context.link._linkAnchor=this.context.anchor.caller.link.linkAnchor=selectionATag;const linkBtn=this.context.link.linkController,link=linkBtn.querySelector("a");link.href=selectionATag.href,link.title=selectionATag.textContent,link.textContent=selectionATag.textContent,this.util.addClass(selectionATag,"on"),this.setControllerPosition(linkBtn,selectionATag,"bottom",{left:0,top:0}),this.controllersOn(linkBtn,selectionATag,"link",this.util.removeClass.bind(this.util,this.context.link._linkAnchor,"on"))},onClick_linkController:function(e){e.stopPropagation();const command=e.target.getAttribute("data-command")||e.target.parentNode.getAttribute("data-command");if(command){if(e.preventDefault(),/update/.test(command))this.plugins.dialog.open.call(this,"link",!0);else if(/unlink/.test(command)){const sc=this.util.getChildElement(this.context.link._linkAnchor,(function(current){return 0===current.childNodes.length||3===current.nodeType}),!1),ec=this.util.getChildElement(this.context.link._linkAnchor,(function(current){return 0===current.childNodes.length||3===current.nodeType}),!0);this.setRange(sc,0,ec,ec.textContent.length),this.nodeChange(null,null,["A"],!1)}else this.util.removeItem(this.context.link._linkAnchor),this.context.anchor.caller.link.linkAnchor=null,this.focus(),this.history.push(!1);this.controllersOff()}},init:function(){this.context.link.linkController.style.display="none",this.plugins.anchor.init.call(this,this.context.anchor.caller.link)}}},"./node_modules/suneditor/src/plugins/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{align:()=>align.Z,audio:()=>audio,blockquote:()=>blockquote,default:()=>plugins,font:()=>font.Z,fontColor:()=>fontColor.Z,fontSize:()=>fontSize.Z,formatBlock:()=>formatBlock.Z,hiliteColor:()=>hiliteColor.Z,horizontalRule:()=>horizontalRule.Z,image:()=>dialog_image.Z,imageGallery:()=>imageGallery,lineHeight:()=>lineHeight.Z,link:()=>dialog_link.Z,list:()=>list.Z,math:()=>math,paragraphStyle:()=>paragraphStyle.Z,table:()=>table.Z,template:()=>template.Z,textStyle:()=>textStyle.Z,video:()=>video});const blockquote={name:"blockquote",display:"command",add:function(core,targetElement){core.context.blockquote={targetButton:targetElement,tag:core.util.createElement("BLOCKQUOTE")}},active:function(element){if(element){if(/blockquote/i.test(element.nodeName))return this.util.addClass(this.context.blockquote.targetButton,"active"),!0}else this.util.removeClass(this.context.blockquote.targetButton,"active");return!1},action:function(){const currentBlockquote=this.util.getParentElement(this.getSelectionNode(),"blockquote");currentBlockquote?this.detachRangeFormatElement(currentBlockquote,null,null,!1,!1):this.applyRangeFormatElement(this.context.blockquote.tag.cloneNode(!1))}};var align=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/align.js"),font=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/font.js"),fontSize=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/fontSize.js"),fontColor=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/fontColor.js"),hiliteColor=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/hiliteColor.js"),horizontalRule=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/horizontalRule.js"),list=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/list.js"),table=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/table.js"),formatBlock=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/formatBlock.js"),lineHeight=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/lineHeight.js"),template=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/template.js"),paragraphStyle=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/paragraphStyle.js"),textStyle=__webpack_require__("./node_modules/suneditor/src/plugins/submenu/textStyle.js"),dialog_link=__webpack_require__("./node_modules/suneditor/src/plugins/dialog/link.js"),dialog_image=__webpack_require__("./node_modules/suneditor/src/plugins/dialog/image.js"),dialog=__webpack_require__("./node_modules/suneditor/src/plugins/modules/dialog.js"),dialog_default=__webpack_require__.n(dialog),component=__webpack_require__("./node_modules/suneditor/src/plugins/modules/component.js"),component_default=__webpack_require__.n(component),resizing=__webpack_require__("./node_modules/suneditor/src/plugins/modules/resizing.js"),resizing_default=__webpack_require__.n(resizing),fileManager=__webpack_require__("./node_modules/suneditor/src/plugins/modules/fileManager.js"),fileManager_default=__webpack_require__.n(fileManager);const video={name:"video",display:"dialog",add:function(core){core.addModule([dialog_default(),component_default(),resizing_default(),fileManager_default()]);const options=core.options,context=core.context,contextVideo=context.video={_infoList:[],_infoIndex:0,_uploadFileLength:0,focusElement:null,sizeUnit:options._videoSizeUnit,_align:"none",_floatClassRegExp:"__se__float\\-[a-z]+",_youtubeQuery:options.youtubeQuery,_videoRatio:100*options.videoRatio+"%",_defaultRatio:100*options.videoRatio+"%",_linkValue:"",_element:null,_cover:null,_container:null,inputX:null,inputY:null,_element_w:1,_element_h:1,_element_l:0,_element_t:0,_defaultSizeX:"100%",_defaultSizeY:100*options.videoRatio+"%",_origin_w:"100%"===options.videoWidth?"":options.videoWidth,_origin_h:"56.25%"===options.videoHeight?"":options.videoHeight,_proportionChecked:!0,_resizing:options.videoResizing,_resizeDotHide:!options.videoHeightShow,_rotation:options.videoRotation,_alignHide:!options.videoAlignShow,_onlyPercentage:options.videoSizeOnlyPercentage,_ratio:!1,_ratioX:1,_ratioY:1,_captionShow:!1};let video_dialog=this.setDialog(core);contextVideo.modal=video_dialog,contextVideo.videoInputFile=video_dialog.querySelector("._se_video_file"),contextVideo.videoUrlFile=video_dialog.querySelector(".se-input-url"),contextVideo.focusElement=contextVideo.videoUrlFile||contextVideo.videoInputFile,contextVideo.preview=video_dialog.querySelector(".se-link-preview"),video_dialog.querySelector("form").addEventListener("submit",this.submit.bind(core)),contextVideo.videoInputFile&&video_dialog.querySelector(".se-dialog-files-edge-button").addEventListener("click",this._removeSelectedFiles.bind(contextVideo.videoInputFile,contextVideo.videoUrlFile,contextVideo.preview)),contextVideo.videoInputFile&&contextVideo.videoUrlFile&&contextVideo.videoInputFile.addEventListener("change",this._fileInputChange.bind(contextVideo)),contextVideo.videoUrlFile&&contextVideo.videoUrlFile.addEventListener("input",this._onLinkPreview.bind(contextVideo.preview,contextVideo,options.linkProtocol)),contextVideo.proportion={},contextVideo.videoRatioOption={},contextVideo.inputX={},contextVideo.inputY={},options.videoResizing&&(contextVideo.proportion=video_dialog.querySelector("._se_video_check_proportion"),contextVideo.videoRatioOption=video_dialog.querySelector(".se-video-ratio"),contextVideo.inputX=video_dialog.querySelector("._se_video_size_x"),contextVideo.inputY=video_dialog.querySelector("._se_video_size_y"),contextVideo.inputX.value=options.videoWidth,contextVideo.inputY.value=options.videoHeight,contextVideo.inputX.addEventListener("keyup",this.setInputSize.bind(core,"x")),contextVideo.inputY.addEventListener("keyup",this.setInputSize.bind(core,"y")),contextVideo.inputX.addEventListener("change",this.setRatio.bind(core)),contextVideo.inputY.addEventListener("change",this.setRatio.bind(core)),contextVideo.proportion.addEventListener("change",this.setRatio.bind(core)),contextVideo.videoRatioOption.addEventListener("change",this.setVideoRatio.bind(core)),video_dialog.querySelector(".se-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(core))),context.dialog.modal.appendChild(video_dialog),video_dialog=null},setDialog:function(core){const option=core.options,lang=core.lang,dialog=core.util.createElement("DIV");dialog.className="se-dialog-content",dialog.style.display="none";let html='<form method="post" enctype="multipart/form-data"><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" title="'+lang.dialogBox.close+'" aria-label="'+lang.dialogBox.close+'">'+core.icons.cancel+'</button><span class="se-modal-title">'+lang.dialogBox.videoBox.title+'</span></div><div class="se-dialog-body">';if(option.videoFileInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.videoBox.file+'</label><div class="se-dialog-form-files"><input class="se-input-form _se_video_file" type="file" accept="'+option.videoAccept+'"'+(option.videoMultipleFile?' multiple="multiple"':"")+'/><button type="button" data-command="filesRemove" class="se-btn se-dialog-files-edge-button se-file-remove" title="'+lang.controller.remove+'" aria-label="'+lang.controller.remove+'">'+core.icons.cancel+"</button></div></div>"),option.videoUrlInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.videoBox.url+'</label><input class="se-input-form se-input-url" type="text" /><pre class="se-link-preview"></pre></div>'),option.videoResizing){const ratioList=option.videoRatioList||[{name:"16:9",value:.5625},{name:"4:3",value:.75},{name:"21:9",value:.4285}],ratio=option.videoRatio,onlyPercentage=option.videoSizeOnlyPercentage,onlyPercentDisplay=onlyPercentage?' style="display: none !important;"':"",heightDisplay=option.videoHeightShow?"":' style="display: none !important;"',ratioDisplay=option.videoRatioShow?"":' style="display: none !important;"',onlyWidthDisplay=onlyPercentage||option.videoHeightShow||option.videoRatioShow?"":' style="display: none !important;"';html+='<div class="se-dialog-form"><div class="se-dialog-size-text"><label class="size-w">'+lang.dialogBox.width+'</label><label class="se-dialog-size-x">&nbsp;</label><label class="size-h"'+heightDisplay+">"+lang.dialogBox.height+'</label><label class="size-h"'+ratioDisplay+">("+lang.dialogBox.ratio+')</label></div><input class="se-input-control _se_video_size_x" placeholder="100%"'+(onlyPercentage?' type="number" min="1"':'type="text"')+(onlyPercentage?' max="100"':"")+'/><label class="se-dialog-size-x"'+onlyWidthDisplay+">"+(onlyPercentage?"%":"x")+'</label><input class="se-input-control _se_video_size_y" placeholder="'+100*option.videoRatio+'%"'+(onlyPercentage?' type="number" min="1"':'type="text"')+(onlyPercentage?' max="100"':"")+heightDisplay+'/><select class="se-input-select se-video-ratio" title="'+lang.dialogBox.ratio+'" aria-label="'+lang.dialogBox.ratio+'"'+ratioDisplay+">",heightDisplay||(html+='<option value=""> - </option>');for(let i=0,len=ratioList.length;i<len;i++)html+='<option value="'+ratioList[i].value+'"'+(ratio.toString()===ratioList[i].value.toString()?" selected":"")+">"+ratioList[i].name+"</option>";html+='</select><button type="button" title="'+lang.dialogBox.revertButton+'" aria-label="'+lang.dialogBox.revertButton+'" class="se-btn se-dialog-btn-revert" style="float: right;">'+core.icons.revert+'</button></div><div class="se-dialog-form se-dialog-form-footer"'+onlyPercentDisplay+onlyWidthDisplay+'><label><input type="checkbox" class="se-dialog-btn-check _se_video_check_proportion" checked/>&nbsp;'+lang.dialogBox.proportion+"</label></div>"}return html+='</div><div class="se-dialog-footer"><div'+(option.videoAlignShow?"":' style="display: none"')+'><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="none" checked>'+lang.dialogBox.basic+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="left">'+lang.dialogBox.left+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="center">'+lang.dialogBox.center+'</label><label><input type="radio" name="suneditor_video_radio" class="se-dialog-btn-radio" value="right">'+lang.dialogBox.right+'</label></div><button type="submit" class="se-btn-primary" title="'+lang.dialogBox.submitButton+'" aria-label="'+lang.dialogBox.submitButton+'"><span>'+lang.dialogBox.submitButton+"</span></button></div></form>",dialog.innerHTML=html,dialog},_fileInputChange:function(){this.videoInputFile.value?(this.videoUrlFile.setAttribute("disabled",!0),this.preview.style.textDecoration="line-through"):(this.videoUrlFile.removeAttribute("disabled"),this.preview.style.textDecoration="")},_removeSelectedFiles:function(urlInput,preview){this.value="",urlInput&&(urlInput.removeAttribute("disabled"),preview.style.textDecoration="")},_onLinkPreview:function(context,protocol,e){const value=e.target.value.trim();/^<iframe.*\/iframe>$/.test(value)?(context._linkValue=value,this.textContent='<IFrame :src=".."></IFrame>'):context._linkValue=this.textContent=value?protocol&&-1===value.indexOf("://")&&0!==value.indexOf("#")?protocol+value:-1===value.indexOf("://")?"/"+value:value:""},_setTagAttrs:function(element){element.setAttribute("controls",!0);const attrs=this.options.videoTagAttrs;if(attrs)for(let key in attrs)this.util.hasOwn(attrs,key)&&element.setAttribute(key,attrs[key])},createVideoTag:function(){const videoTag=this.util.createElement("VIDEO");return this.plugins.video._setTagAttrs.call(this,videoTag),videoTag},_setIframeAttrs:function(element){element.frameBorder="0",element.allowFullscreen=!0;const attrs=this.options.videoIframeAttrs;if(attrs)for(let key in attrs)this.util.hasOwn(attrs,key)&&element.setAttribute(key,attrs[key])},createIframeTag:function(){const iframeTag=this.util.createElement("IFRAME");return this.plugins.video._setIframeAttrs.call(this,iframeTag),iframeTag},fileTags:["iframe","video"],select:function(element){this.plugins.video.onModifyMode.call(this,element,this.plugins.resizing.call_controller_resize.call(this,element,"video"))},destroy:function(element){const frame=element||this.context.video._element,container=this.context.video._container,dataIndex=1*frame.getAttribute("data-index");let focusEl=container.previousElementSibling||container.nextElementSibling;const emptyDiv=container.parentNode;this.util.removeItem(container),this.plugins.video.init.call(this),this.controllersOff(),emptyDiv!==this.context.element.wysiwyg&&this.util.removeItemAllParents(emptyDiv,(function(current){return 0===current.childNodes.length}),null),this.focusEdge(focusEl),this.plugins.fileManager.deleteInfo.call(this,"video",dataIndex,this.functions.onVideoUpload),this.history.push(!1)},on:function(update){const contextVideo=this.context.video;update?contextVideo.videoInputFile&&this.options.videoMultipleFile&&contextVideo.videoInputFile.removeAttribute("multiple"):(contextVideo.inputX.value=contextVideo._origin_w=this.options.videoWidth===contextVideo._defaultSizeX?"":this.options.videoWidth,contextVideo.inputY.value=contextVideo._origin_h=this.options.videoHeight===contextVideo._defaultSizeY?"":this.options.videoHeight,contextVideo.proportion.disabled=!0,contextVideo.videoInputFile&&this.options.videoMultipleFile&&contextVideo.videoInputFile.setAttribute("multiple","multiple")),contextVideo._resizing&&this.plugins.video.setVideoRatioSelect.call(this,contextVideo._origin_h||contextVideo._defaultRatio)},open:function(){this.plugins.dialog.open.call(this,"video","video"===this.currentControllerName)},setVideoRatio:function(e){const contextVideo=this.context.video,value=e.target.options[e.target.selectedIndex].value;contextVideo._defaultSizeY=contextVideo._videoRatio=value?100*value+"%":contextVideo._defaultSizeY,contextVideo.inputY.placeholder=value?100*value+"%":"",contextVideo.inputY.value=""},setInputSize:function(xy,e){if(e&&32===e.keyCode)return void e.preventDefault();const contextVideo=this.context.video;this.plugins.resizing._module_setInputSize.call(this,contextVideo,xy),"y"===xy&&this.plugins.video.setVideoRatioSelect.call(this,e.target.value||contextVideo._defaultRatio)},setRatio:function(){this.plugins.resizing._module_setRatio.call(this,this.context.video)},submit:function(e){const contextVideo=this.context.video,videoPlugin=this.plugins.video;e.preventDefault(),e.stopPropagation(),contextVideo._align=contextVideo.modal.querySelector('input[name="suneditor_video_radio"]:checked').value;try{contextVideo.videoInputFile&&contextVideo.videoInputFile.files.length>0?(this.showLoading(),videoPlugin.submitAction.call(this,this.context.video.videoInputFile.files)):contextVideo.videoUrlFile&&contextVideo._linkValue.length>0&&(this.showLoading(),videoPlugin.setup_url.call(this,contextVideo._linkValue))}catch(error){throw this.closeLoading(),Error('[SUNEDITOR.video.submit.fail] cause : "'+error.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(fileList){if(0===fileList.length)return;let fileSize=0,files=[];for(let i=0,len=fileList.length;i<len;i++)/video/i.test(fileList[i].type)&&(files.push(fileList[i]),fileSize+=fileList[i].size);const limitSize=this.options.videoUploadSizeLimit;if(limitSize>0){let infoSize=0;const videosInfo=this.context.video._infoList;for(let i=0,len=videosInfo.length;i<len;i++)infoSize+=1*videosInfo[i].size;if(fileSize+infoSize>limitSize){this.closeLoading();const err="[SUNEDITOR.videoUpload.fail] Size of uploadable total videos: "+limitSize/1e3+"KB";return void(("function"!=typeof this.functions.onVideoUploadError||this.functions.onVideoUploadError(err,{limitSize,currentSize:infoSize,uploadSize:fileSize},this))&&this.functions.noticeOpen(err))}}const contextVideo=this.context.video;contextVideo._uploadFileLength=files.length;const info={inputWidth:contextVideo.inputX.value,inputHeight:contextVideo.inputY.value,align:contextVideo._align,isUpdate:this.context.dialog.updateModal,element:contextVideo._element};if("function"==typeof this.functions.onVideoUploadBefore){const result=this.functions.onVideoUploadBefore(files,info,this,function(data){data&&this._w.Array.isArray(data.result)?this.plugins.video.register.call(this,info,data):this.plugins.video.upload.call(this,info,data)}.bind(this));if(void 0===result)return;if(!result)return void this.closeLoading();"object"==typeof result&&result.length>0&&(files=result)}this.plugins.video.upload.call(this,info,files)},error:function(message,response){if(this.closeLoading(),"function"!=typeof this.functions.onVideoUploadError||this.functions.onVideoUploadError(message,response,this))throw this.functions.noticeOpen(message),Error("[SUNEDITOR.plugin.video.error] response: "+message)},upload:function(info,files){if(!files)return void this.closeLoading();if("string"==typeof files)return void this.plugins.video.error.call(this,files,null);const videoUploadUrl=this.options.videoUploadUrl,filesLen=this.context.dialog.updateModal?1:files.length;if(!("string"==typeof videoUploadUrl&&videoUploadUrl.length>0))throw Error('[SUNEDITOR.videoUpload.fail] cause : There is no "videoUploadUrl" option.');{const formData=new FormData;for(let i=0;i<filesLen;i++)formData.append("file-"+i,files[i]);this.plugins.fileManager.upload.call(this,videoUploadUrl,this.options.videoUploadHeader,formData,this.plugins.video.callBack_videoUpload.bind(this,info),this.functions.onVideoUploadError)}},callBack_videoUpload:function(info,xmlHttp){if("function"==typeof this.functions.videoUploadHandler)this.functions.videoUploadHandler(xmlHttp,info,this);else{const response=JSON.parse(xmlHttp.responseText);response.errorMessage?this.plugins.video.error.call(this,response.errorMessage,response):this.plugins.video.register.call(this,info,response)}},register:function(info,response){const fileList=response.result,videoTag=this.plugins.video.createVideoTag.call(this);for(let file,i=0,len=fileList.length;i<len;i++)file={name:fileList[i].name,size:fileList[i].size},this.plugins.video.create_video.call(this,info.isUpdate?info.element:videoTag.cloneNode(!1),fileList[i].url,info.inputWidth,info.inputHeight,info.align,file,info.isUpdate);this.closeLoading()},setup_url:function(url){try{const contextVideo=this.context.video;if(url||(url=contextVideo._linkValue),!url)return!1;if(/^<iframe.*\/iframe>$/.test(url)){if(0===(url=(new this._w.DOMParser).parseFromString(url,"text/html").querySelector("iframe").src).length)return!1}if(/youtu\.?be/.test(url)){if(/^http/.test(url)||(url="https://"+url),url=url.replace("watch?v=",""),/^\/\/.+\/embed\//.test(url)||(url=url.replace(url.match(/\/\/.+\//)[0],"//www.youtube.com/embed/").replace("&","?&")),contextVideo._youtubeQuery.length>0)if(/\?/.test(url)){const splitUrl=url.split("?");url=splitUrl[0]+"?"+contextVideo._youtubeQuery+"&"+splitUrl[1]}else url+="?"+contextVideo._youtubeQuery}else/vimeo\.com/.test(url)&&(url.endsWith("/")&&(url=url.slice(0,-1)),url="https://player.vimeo.com/video/"+url.slice(url.lastIndexOf("/")+1));this.plugins.video.create_video.call(this,this.plugins.video[/embed|iframe|player|\/e\/|\.php|\.html?/.test(url)||/vimeo\.com/.test(url)?"createIframeTag":"createVideoTag"].call(this),url,contextVideo.inputX.value,contextVideo.inputY.value,contextVideo._align,null,this.context.dialog.updateModal)}catch(error){throw Error('[SUNEDITOR.video.upload.fail] cause : "'+error.message+'"')}finally{this.closeLoading()}},create_video:function(oFrame,src,width,height,align,file,isUpdate){this.context.resizing._resize_plugin="video";const contextVideo=this.context.video;let cover=null,container=null,init=!1;if(isUpdate){if((oFrame=contextVideo._element).src!==src){init=!0;const isYoutube=/youtu\.?be/.test(src),isVimeo=/vimeo\.com/.test(src);if(!isYoutube&&!isVimeo||/^iframe$/i.test(oFrame.nodeName))if(isYoutube||isVimeo||/^videoo$/i.test(oFrame.nodeName))oFrame.src=src;else{const newTag=this.plugins.video.createVideoTag.call(this);newTag.src=src,oFrame.parentNode.replaceChild(newTag,oFrame),contextVideo._element=oFrame=newTag}else{const newTag=this.plugins.video.createIframeTag.call(this);newTag.src=src,oFrame.parentNode.replaceChild(newTag,oFrame),contextVideo._element=oFrame=newTag}}container=contextVideo._container,cover=this.util.getParentElement(oFrame,"FIGURE")}else init=!0,oFrame.src=src,contextVideo._element=oFrame,cover=this.plugins.component.set_cover.call(this,oFrame),container=this.plugins.component.set_container.call(this,cover,"se-video-container");contextVideo._cover=cover,contextVideo._container=container;const inputUpdate=this.plugins.resizing._module_getSizeX.call(this,contextVideo)!==(width||contextVideo._defaultSizeX)||this.plugins.resizing._module_getSizeY.call(this,contextVideo)!==(height||contextVideo._videoRatio),changeSize=!isUpdate||inputUpdate;contextVideo._resizing&&(this.context.video._proportionChecked=contextVideo.proportion.checked,oFrame.setAttribute("data-proportion",contextVideo._proportionChecked));let isPercent=!1;changeSize&&(isPercent=this.plugins.video.applySize.call(this)),isPercent&&"center"===align||this.plugins.video.setAlign.call(this,null,oFrame,cover,container);let changed=!0;if(isUpdate)contextVideo._resizing&&this.context.resizing._rotateVertical&&changeSize&&this.plugins.resizing.setTransformSize.call(this,oFrame,null,null);else if(changed=this.insertComponent(container,!1,!0,!this.options.mediaAutoSelect),!this.options.mediaAutoSelect){const line=this.appendFormatTag(container,null);line&&this.setRange(line,0,line,0)}changed&&(init&&this.plugins.fileManager.setInfo.call(this,"video",oFrame,this.functions.onVideoUpload,file,!0),isUpdate&&(this.selectComponent(oFrame,"video"),this.history.push(!1))),this.context.resizing._resize_plugin=""},_update_videoCover:function(oFrame){if(!oFrame)return;const contextVideo=this.context.video;/^video$/i.test(oFrame.nodeName)?this.plugins.video._setTagAttrs.call(this,oFrame):this.plugins.video._setIframeAttrs.call(this,oFrame);let existElement=this.util.isRangeFormatElement(oFrame.parentNode)||this.util.isWysiwygDiv(oFrame.parentNode)?oFrame:this.util.getFormatElement(oFrame)||oFrame;const prevFrame=oFrame;contextVideo._element=oFrame=oFrame.cloneNode(!0);const cover=contextVideo._cover=this.plugins.component.set_cover.call(this,oFrame),container=contextVideo._container=this.plugins.component.set_container.call(this,cover,"se-video-container");try{const figcaption=existElement.querySelector("figcaption");let caption=null;figcaption&&(caption=this.util.createElement("DIV"),caption.innerHTML=figcaption.innerHTML,this.util.removeItem(figcaption));const size=(oFrame.getAttribute("data-size")||oFrame.getAttribute("data-origin")||"").split(",");this.plugins.video.applySize.call(this,size[0]||prevFrame.style.width||prevFrame.width||"",size[1]||prevFrame.style.height||prevFrame.height||"");const format=this.util.getFormatElement(prevFrame);if(format&&(contextVideo._align=format.style.textAlign||format.style.float),this.plugins.video.setAlign.call(this,null,oFrame,cover,container),this.util.getParentElement(prevFrame,this.util.isNotCheckingNode))prevFrame.parentNode.replaceChild(container,prevFrame);else if(this.util.isListCell(existElement)){const refer=this.util.getParentElement(prevFrame,(function(current){return current.parentNode===existElement}));existElement.insertBefore(container,refer),this.util.removeItem(prevFrame),this.util.removeEmptyNode(refer,null,!0)}else if(this.util.isFormatElement(existElement)){const refer=this.util.getParentElement(prevFrame,(function(current){return current.parentNode===existElement}));existElement=this.util.splitElement(existElement,refer),existElement.parentNode.insertBefore(container,existElement),this.util.removeItem(prevFrame),this.util.removeEmptyNode(existElement,null,!0),0===existElement.children.length&&(existElement.innerHTML=this.util.htmlRemoveWhiteSpace(existElement.innerHTML))}else existElement.parentNode.replaceChild(container,existElement);caption&&existElement.parentNode.insertBefore(caption,container.nextElementSibling)}catch(error){console.warn("[SUNEDITOR.video.error] Maybe the video tag is nested.",error)}this.plugins.fileManager.setInfo.call(this,"video",oFrame,this.functions.onVideoUpload,null,!0),this.plugins.video.init.call(this)},onModifyMode:function(element,size){const contextVideo=this.context.video;contextVideo._element=element,contextVideo._cover=this.util.getParentElement(element,"FIGURE"),contextVideo._container=this.util.getParentElement(element,this.util.isMediaComponent),contextVideo._align=element.style.float||element.getAttribute("data-align")||"none",element.style.float="",size&&(contextVideo._element_w=size.w,contextVideo._element_h=size.h,contextVideo._element_t=size.t,contextVideo._element_l=size.l);let w,h,origin=contextVideo._element.getAttribute("data-size")||contextVideo._element.getAttribute("data-origin");origin?(origin=origin.split(","),w=origin[0],h=origin[1]):size&&(w=size.w,h=size.h),contextVideo._origin_w=w||element.style.width||element.width||"",contextVideo._origin_h=h||element.style.height||element.height||""},openModify:function(notOpen){const contextVideo=this.context.video;if(contextVideo.videoUrlFile&&(contextVideo._linkValue=contextVideo.preview.textContent=contextVideo.videoUrlFile.value=contextVideo._element.src||(contextVideo._element.querySelector("source")||"").src||""),(contextVideo.modal.querySelector('input[name="suneditor_video_radio"][value="'+contextVideo._align+'"]')||contextVideo.modal.querySelector('input[name="suneditor_video_radio"][value="none"]')).checked=!0,contextVideo._resizing){this.plugins.resizing._module_setModifyInputSize.call(this,contextVideo,this.plugins.video);const y=contextVideo._videoRatio=this.plugins.resizing._module_getSizeY.call(this,contextVideo);this.plugins.video.setVideoRatioSelect.call(this,y)||(contextVideo.inputY.value=contextVideo._onlyPercentage?this.util.getNumber(y,2):y)}notOpen||this.plugins.dialog.open.call(this,"video",!0)},setVideoRatioSelect:function(value){let ratioSelected=!1;const contextVideo=this.context.video,ratioOptions=contextVideo.videoRatioOption.options;/%$/.test(value)||contextVideo._onlyPercentage?value=this.util.getNumber(value,2)/100+"":(!this.util.isNumber(value)||1*value>=1)&&(value=""),contextVideo.inputY.placeholder="";for(let i=0,len=ratioOptions.length;i<len;i++)ratioOptions[i].value===value?(ratioSelected=ratioOptions[i].selected=!0,contextVideo.inputY.placeholder=value?100*value+"%":""):ratioOptions[i].selected=!1;return ratioSelected},checkFileInfo:function(){this.plugins.fileManager.checkInfo.call(this,"video",["iframe","video"],this.functions.onVideoUpload,this.plugins.video._update_videoCover.bind(this),!0)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"video",this.functions.onVideoUpload)},applySize:function(w,h){const contextVideo=this.context.video;return w||(w=contextVideo.inputX.value||this.options.videoWidth),h||(h=contextVideo.inputY.value||this.options.videoHeight),contextVideo._onlyPercentage||/%$/.test(w)||!w?(this.plugins.video.setPercentSize.call(this,w||"100%",h||(/%$/.test(contextVideo._videoRatio)?contextVideo._videoRatio:contextVideo._defaultRatio)),!0):(w&&"auto"!==w||h&&"auto"!==h?this.plugins.video.setSize.call(this,w,h||contextVideo._videoRatio||contextVideo._defaultRatio,!1):this.plugins.video.setAutoSize.call(this),!1)},sizeRevert:function(){this.plugins.resizing._module_sizeRevert.call(this,this.context.video)},setSize:function(w,h,notResetPercentage,direction){const contextVideo=this.context.video,onlyW=/^(rw|lw)$/.test(direction),onlyH=/^(th|bh)$/.test(direction);onlyH||(w=this.util.getNumber(w,0)),onlyW||(h=this.util.isNumber(h)?h+contextVideo.sizeUnit:h||""),w=w?w+contextVideo.sizeUnit:"",onlyH||(contextVideo._element.style.width=w),onlyW||(contextVideo._cover.style.paddingBottom=contextVideo._cover.style.height=h),onlyH||/%$/.test(w)||(contextVideo._cover.style.width=w,contextVideo._container.style.width=""),onlyW||/%$/.test(h)?contextVideo._element.style.height="":contextVideo._element.style.height=h,notResetPercentage||contextVideo._element.removeAttribute("data-percentage"),this.plugins.resizing._module_saveCurrentSize.call(this,contextVideo)},setAutoSize:function(){this.plugins.video.setPercentSize.call(this,100,this.context.video._defaultRatio)},setOriginSize:function(dataSize){const contextVideo=this.context.video;contextVideo._element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,contextVideo._element),this.plugins.video.cancelPercentAttr.call(this);const originSize=((dataSize?contextVideo._element.getAttribute("data-size"):"")||contextVideo._element.getAttribute("data-origin")||"").split(",");if(originSize){const w=originSize[0],h=originSize[1];contextVideo._onlyPercentage||/%$/.test(w)&&(/%$/.test(h)||!/\d/.test(h))?this.plugins.video.setPercentSize.call(this,w,h):this.plugins.video.setSize.call(this,w,h),this.plugins.resizing._module_saveCurrentSize.call(this,contextVideo)}},setPercentSize:function(w,h){const contextVideo=this.context.video;h=!h||/%$/.test(h)||this.util.getNumber(h,0)?this.util.isNumber(h)?h+contextVideo.sizeUnit:h||contextVideo._defaultRatio:this.util.isNumber(h)?h+"%":h,contextVideo._container.style.width=this.util.isNumber(w)?w+"%":w,contextVideo._container.style.height="",contextVideo._cover.style.width="100%",contextVideo._cover.style.height=h,contextVideo._cover.style.paddingBottom=h,contextVideo._element.style.width="100%",contextVideo._element.style.height="100%",contextVideo._element.style.maxWidth="","center"===contextVideo._align&&this.plugins.video.setAlign.call(this,null,null,null,null),contextVideo._element.setAttribute("data-percentage",w+","+h),this.plugins.resizing._module_saveCurrentSize.call(this,contextVideo)},cancelPercentAttr:function(){const contextVideo=this.context.video;contextVideo._cover.style.width="",contextVideo._cover.style.height="",contextVideo._cover.style.paddingBottom="",contextVideo._container.style.width="",contextVideo._container.style.height="",this.util.removeClass(contextVideo._container,this.context.video._floatClassRegExp),this.util.addClass(contextVideo._container,"__se__float-"+contextVideo._align),"center"===contextVideo._align&&this.plugins.video.setAlign.call(this,null,null,null,null)},setAlign:function(align,element,cover,container){const contextVideo=this.context.video;align||(align=contextVideo._align),element||(element=contextVideo._element),cover||(cover=contextVideo._cover),container||(container=contextVideo._container),cover.style.margin=align&&"none"!==align?"auto":"0",/%$/.test(element.style.width)&&"center"===align?(container.style.minWidth="100%",cover.style.width=container.style.width,cover.style.height=cover.style.height,cover.style.paddingBottom=/%$/.test(cover.style.height)?this.util.getNumber(this.util.getNumber(cover.style.height,2)/100*this.util.getNumber(cover.style.width,2),2)+"%":cover.style.height):(container.style.minWidth="",cover.style.width=this.context.resizing._rotateVertical?element.style.height||element.offsetHeight:element.style.width||"100%",cover.style.paddingBottom=cover.style.height),this.util.hasClass(container,"__se__float-"+align)||(this.util.removeClass(container,contextVideo._floatClassRegExp),this.util.addClass(container,"__se__float-"+align)),element.setAttribute("data-align",align)},init:function(){const contextVideo=this.context.video;contextVideo.videoInputFile&&(contextVideo.videoInputFile.value=""),contextVideo.videoUrlFile&&(contextVideo._linkValue=contextVideo.preview.textContent=contextVideo.videoUrlFile.value=""),contextVideo.videoInputFile&&contextVideo.videoUrlFile&&(contextVideo.videoUrlFile.removeAttribute("disabled"),contextVideo.preview.style.textDecoration=""),contextVideo._origin_w=this.options.videoWidth,contextVideo._origin_h=this.options.videoHeight,contextVideo.modal.querySelector('input[name="suneditor_video_radio"][value="none"]').checked=!0,contextVideo._resizing&&(contextVideo.inputX.value=this.options.videoWidth===contextVideo._defaultSizeX?"":this.options.videoWidth,contextVideo.inputY.value=this.options.videoHeight===contextVideo._defaultSizeY?"":this.options.videoHeight,contextVideo.proportion.checked=!0,contextVideo.proportion.disabled=!0,this.plugins.video.setVideoRatioSelect.call(this,contextVideo._defaultRatio))}},audio={name:"audio",display:"dialog",add:function(core){core.addModule([dialog_default(),component_default(),fileManager_default()]);const context=core.context,contextAudio=context.audio={_infoList:[],_infoIndex:0,_uploadFileLength:0,focusElement:null,targetSelect:null,_origin_w:core.options.audioWidth,_origin_h:core.options.audioHeight,_linkValue:"",_element:null,_cover:null,_container:null};let audio_dialog=this.setDialog(core);contextAudio.modal=audio_dialog,contextAudio.audioInputFile=audio_dialog.querySelector("._se_audio_files"),contextAudio.audioUrlFile=audio_dialog.querySelector(".se-input-url"),contextAudio.focusElement=contextAudio.audioInputFile||contextAudio.audioUrlFile,contextAudio.preview=audio_dialog.querySelector(".se-link-preview");let audio_controller=this.setController(core);contextAudio.controller=audio_controller,audio_dialog.querySelector("form").addEventListener("submit",this.submit.bind(core)),contextAudio.audioInputFile&&audio_dialog.querySelector(".se-dialog-files-edge-button").addEventListener("click",this._removeSelectedFiles.bind(contextAudio.audioInputFile,contextAudio.audioUrlFile,contextAudio.preview)),contextAudio.audioInputFile&&contextAudio.audioUrlFile&&contextAudio.audioInputFile.addEventListener("change",this._fileInputChange.bind(contextAudio)),audio_controller.addEventListener("click",this.onClick_controller.bind(core)),contextAudio.audioUrlFile&&contextAudio.audioUrlFile.addEventListener("input",this._onLinkPreview.bind(contextAudio.preview,contextAudio,core.options.linkProtocol)),context.dialog.modal.appendChild(audio_dialog),context.element.relative.appendChild(audio_controller),audio_dialog=null,audio_controller=null},setDialog:function(core){const option=core.options,lang=core.lang,dialog=core.util.createElement("DIV");dialog.className="se-dialog-content",dialog.style.display="none";let html='<form method="post" enctype="multipart/form-data"><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" title="'+lang.dialogBox.close+'" aria-label="'+lang.dialogBox.close+'">'+core.icons.cancel+'</button><span class="se-modal-title">'+lang.dialogBox.audioBox.title+'</span></div><div class="se-dialog-body">';return option.audioFileInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.audioBox.file+'</label><div class="se-dialog-form-files"><input class="se-input-form _se_audio_files" type="file" accept="'+option.audioAccept+'"'+(option.audioMultipleFile?' multiple="multiple"':"")+'/><button type="button" data-command="filesRemove" class="se-btn se-dialog-files-edge-button se-file-remove" title="'+lang.controller.remove+'" aria-label="'+lang.controller.remove+'">'+core.icons.cancel+"</button></div></div>"),option.audioUrlInput&&(html+='<div class="se-dialog-form"><label>'+lang.dialogBox.audioBox.url+'</label><input class="se-input-form se-input-url" type="text" /><pre class="se-link-preview"></pre></div>'),html+='</div><div class="se-dialog-footer"><button type="submit" class="se-btn-primary" title="'+lang.dialogBox.submitButton+'" aria-label="'+lang.dialogBox.submitButton+'"><span>'+lang.dialogBox.submitButton+"</span></button></div></form>",dialog.innerHTML=html,dialog},setController:function(core){const lang=core.lang,icons=core.icons,link_btn=core.util.createElement("DIV");return link_btn.className="se-controller se-controller-link",link_btn.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="link-content"><div class="se-btn-group"><button type="button" data-command="update" tabindex="-1" class="se-tooltip">'+icons.edit+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.edit+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="se-tooltip">'+icons.delete+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.remove+"</span></span></button></div></div>",link_btn},_fileInputChange:function(){this.audioInputFile.value?(this.audioUrlFile.setAttribute("disabled",!0),this.preview.style.textDecoration="line-through"):(this.audioUrlFile.removeAttribute("disabled"),this.preview.style.textDecoration="")},_removeSelectedFiles:function(urlInput,preview){this.value="",urlInput&&(urlInput.removeAttribute("disabled"),preview.style.textDecoration="")},_createAudioTag:function(){const oAudio=this.util.createElement("AUDIO");this.plugins.audio._setTagAttrs.call(this,oAudio);const w=this.context.audio._origin_w,h=this.context.audio._origin_h;return oAudio.setAttribute("origin-size",w+","+h),oAudio.style.cssText=(w?"width:"+w+"; ":"")+(h?"height:"+h+";":""),oAudio},_setTagAttrs:function(element){element.setAttribute("controls",!0);const attrs=this.options.audioTagAttrs;if(attrs)for(let key in attrs)this.util.hasOwn(attrs,key)&&element.setAttribute(key,attrs[key])},_onLinkPreview:function(context,protocol,e){const value=e.target.value.trim();context._linkValue=this.textContent=value?protocol&&-1===value.indexOf("://")&&0!==value.indexOf("#")?protocol+value:-1===value.indexOf("://")?"/"+value:value:""},fileTags:["audio"],select:function(element){this.plugins.audio.onModifyMode.call(this,element)},destroy:function(element){element=element||this.context.audio._element;const container=this.util.getParentElement(element,this.util.isComponent)||element,dataIndex=1*element.getAttribute("data-index"),focusEl=container.previousElementSibling||container.nextElementSibling,emptyDiv=container.parentNode;this.util.removeItem(container),this.plugins.audio.init.call(this),this.controllersOff(),emptyDiv!==this.context.element.wysiwyg&&this.util.removeItemAllParents(emptyDiv,(function(current){return 0===current.childNodes.length}),null),this.focusEdge(focusEl),this.plugins.fileManager.deleteInfo.call(this,"audio",dataIndex,this.functions.onAudioUpload),this.history.push(!1)},checkFileInfo:function(){this.plugins.fileManager.checkInfo.call(this,"audio",["audio"],this.functions.onAudioUpload,this.plugins.audio.updateCover.bind(this),!1)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"audio",this.functions.onAudioUpload)},on:function(update){const contextAudio=this.context.audio;update?contextAudio._element?(this.context.dialog.updateModal=!0,contextAudio._linkValue=contextAudio.preview.textContent=contextAudio.audioUrlFile.value=contextAudio._element.src,contextAudio.audioInputFile&&this.options.audioMultipleFile&&contextAudio.audioInputFile.removeAttribute("multiple")):contextAudio.audioInputFile&&this.options.audioMultipleFile&&contextAudio.audioInputFile.removeAttribute("multiple"):(this.plugins.audio.init.call(this),contextAudio.audioInputFile&&this.options.audioMultipleFile&&contextAudio.audioInputFile.setAttribute("multiple","multiple"))},open:function(){this.plugins.dialog.open.call(this,"audio","audio"===this.currentControllerName)},submit:function(e){const contextAudio=this.context.audio;e.preventDefault(),e.stopPropagation();try{contextAudio.audioInputFile&&contextAudio.audioInputFile.files.length>0?(this.showLoading(),this.plugins.audio.submitAction.call(this,contextAudio.audioInputFile.files)):contextAudio.audioUrlFile&&contextAudio._linkValue.length>0&&(this.showLoading(),this.plugins.audio.setupUrl.call(this,contextAudio._linkValue))}catch(error){throw this.closeLoading(),Error('[SUNEDITOR.audio.submit.fail] cause : "'+error.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(fileList){if(0===fileList.length)return;let fileSize=0,files=[];for(let i=0,len=fileList.length;i<len;i++)/audio/i.test(fileList[i].type)&&(files.push(fileList[i]),fileSize+=fileList[i].size);const limitSize=this.options.audioUploadSizeLimit;if(limitSize>0){let infoSize=0;const audiosInfo=this.context.audio._infoList;for(let i=0,len=audiosInfo.length;i<len;i++)infoSize+=1*audiosInfo[i].size;if(fileSize+infoSize>limitSize){this.closeLoading();const err="[SUNEDITOR.audioUpload.fail] Size of uploadable total audios: "+limitSize/1e3+"KB";return void(("function"!=typeof this.functions.onAudioUploadError||this.functions.onAudioUploadError(err,{limitSize,currentSize:infoSize,uploadSize:fileSize},this))&&this.functions.noticeOpen(err))}}const contextAudio=this.context.audio;contextAudio._uploadFileLength=files.length;const info={isUpdate:this.context.dialog.updateModal,element:contextAudio._element};if("function"==typeof this.functions.onAudioUploadBefore){const result=this.functions.onAudioUploadBefore(files,info,this,function(data){data&&this._w.Array.isArray(data.result)?this.plugins.audio.register.call(this,info,data):this.plugins.audio.upload.call(this,info,data)}.bind(this));if(void 0===result)return;if(!result)return void this.closeLoading();"object"==typeof result&&result.length>0&&(files=result)}this.plugins.audio.upload.call(this,info,files)},error:function(message,response){if(this.closeLoading(),"function"!=typeof this.functions.onAudioUploadError||this.functions.onAudioUploadError(message,response,this))throw this.functions.noticeOpen(message),Error("[SUNEDITOR.plugin.audio.exception] response: "+message)},upload:function(info,files){if(!files)return void this.closeLoading();if("string"==typeof files)return void this.plugins.audio.error.call(this,files,null);const audioUploadUrl=this.options.audioUploadUrl,filesLen=this.context.dialog.updateModal?1:files.length,formData=new FormData;for(let i=0;i<filesLen;i++)formData.append("file-"+i,files[i]);this.plugins.fileManager.upload.call(this,audioUploadUrl,this.options.audioUploadHeader,formData,this.plugins.audio.callBack_upload.bind(this,info),this.functions.onAudioUploadError)},callBack_upload:function(info,xmlHttp){if("function"==typeof this.functions.audioUploadHandler)this.functions.audioUploadHandler(xmlHttp,info,this);else{const response=JSON.parse(xmlHttp.responseText);response.errorMessage?this.plugins.audio.error.call(this,response.errorMessage,response):this.plugins.audio.register.call(this,info,response)}},register:function(info,response){const fileList=response.result;for(let file,oAudio,i=0,len=fileList.length;i<len;i++)oAudio=info.isUpdate?info.element:this.plugins.audio._createAudioTag.call(this),file={name:fileList[i].name,size:fileList[i].size},this.plugins.audio.create_audio.call(this,oAudio,fileList[i].url,file,info.isUpdate);this.closeLoading()},setupUrl:function(src){try{if(0===src.length)return!1;this.plugins.audio.create_audio.call(this,this.plugins.audio._createAudioTag.call(this),src,null,this.context.dialog.updateModal)}catch(error){throw Error('[SUNEDITOR.audio.audio.fail] cause : "'+error.message+'"')}finally{this.closeLoading()}},create_audio:function(element,src,file,isUpdate){const contextAudio=this.context.audio;if(isUpdate){if(contextAudio._element&&(element=contextAudio._element),!element||element.src===src)return void this.selectComponent(element,"audio");element.src=src,this.selectComponent(element,"audio")}else{element.src=src;const cover=this.plugins.component.set_cover.call(this,element),container=this.plugins.component.set_container.call(this,cover,"");if(!this.insertComponent(container,!1,!0,!this.options.mediaAutoSelect))return void this.focus();if(!this.options.mediaAutoSelect){const line=this.appendFormatTag(container,null);line&&this.setRange(line,0,line,0)}}this.plugins.fileManager.setInfo.call(this,"audio",element,this.functions.onAudioUpload,file,!1),isUpdate&&this.history.push(!1)},updateCover:function(element){const contextAudio=this.context.audio;this.plugins.audio._setTagAttrs.call(this,element);let existElement=this.util.isRangeFormatElement(element.parentNode)||this.util.isWysiwygDiv(element.parentNode)?element:this.util.getFormatElement(element)||element;const prevElement=element;contextAudio._element=element=element.cloneNode(!1);const cover=this.plugins.component.set_cover.call(this,element),container=this.plugins.component.set_container.call(this,cover,"se-audio-container");try{if(this.util.getParentElement(prevElement,this.util.isNotCheckingNode))prevElement.parentNode.replaceChild(container,prevElement);else if(this.util.isListCell(existElement)){const refer=this.util.getParentElement(prevElement,(function(current){return current.parentNode===existElement}));existElement.insertBefore(container,refer),this.util.removeItem(prevElement),this.util.removeEmptyNode(refer,null,!0)}else if(this.util.isFormatElement(existElement)){const refer=this.util.getParentElement(prevElement,(function(current){return current.parentNode===existElement}));existElement=this.util.splitElement(existElement,refer),existElement.parentNode.insertBefore(container,existElement),this.util.removeItem(prevElement),this.util.removeEmptyNode(existElement,null,!0),0===existElement.children.length&&(existElement.innerHTML=this.util.htmlRemoveWhiteSpace(existElement.innerHTML))}else existElement.parentNode.replaceChild(container,existElement)}catch(error){console.warn("[SUNEDITOR.audio.error] Maybe the audio tag is nested.",error)}this.plugins.fileManager.setInfo.call(this,"audio",element,this.functions.onAudioUpload,null,!1),this.plugins.audio.init.call(this)},onModifyMode:function(selectionTag){const contextAudio=this.context.audio;this.setControllerPosition(contextAudio.controller,selectionTag,"bottom",{left:0,top:0}),this.controllersOn(contextAudio.controller,selectionTag,this.plugins.audio.onControllerOff.bind(this,selectionTag),"audio"),this.util.addClass(selectionTag,"active"),contextAudio._element=selectionTag,contextAudio._cover=this.util.getParentElement(selectionTag,"FIGURE"),contextAudio._container=this.util.getParentElement(selectionTag,this.util.isComponent)},openModify:function(notOpen){if(this.context.audio.audioUrlFile){const contextAudio=this.context.audio;contextAudio._linkValue=contextAudio.preview.textContent=contextAudio.audioUrlFile.value=contextAudio._element.src}notOpen||this.plugins.dialog.open.call(this,"audio",!0)},onClick_controller:function(e){e.stopPropagation();const command=e.target.getAttribute("data-command");command&&(e.preventDefault(),/update/.test(command)?this.plugins.audio.openModify.call(this,!1):this.plugins.audio.destroy.call(this,this.context.audio._element),this.controllersOff())},onControllerOff:function(selectionTag){this.util.removeClass(selectionTag,"active"),this.context.audio.controller.style.display="none"},init:function(){if(this.context.dialog.updateModal)return;const contextAudio=this.context.audio;contextAudio.audioInputFile&&(contextAudio.audioInputFile.value=""),contextAudio.audioUrlFile&&(contextAudio._linkValue=contextAudio.preview.textContent=contextAudio.audioUrlFile.value=""),contextAudio.audioInputFile&&contextAudio.audioUrlFile&&(contextAudio.audioUrlFile.removeAttribute("disabled"),contextAudio.preview.style.textDecoration=""),contextAudio._element=null}},math={name:"math",display:"dialog",add:function(core){core.addModule([dialog_default()]);const context=core.context;context.math={focusElement:null,previewElement:null,fontSizeElement:null,defaultFontSize:"",_mathExp:null};let math_dialog=this.setDialog(core);context.math.modal=math_dialog,context.math.focusElement=math_dialog.querySelector(".se-math-exp"),context.math.previewElement=math_dialog.querySelector(".se-math-preview"),context.math.fontSizeElement=math_dialog.querySelector(".se-math-size"),context.math.focusElement.addEventListener(core.util.isIE?"textinput":"input",this._renderMathExp.bind(core,context.math),!1),context.math.fontSizeElement.addEventListener("change",function(e){this.fontSize=e.target.value}.bind(context.math.previewElement.style),!1);let math_controller=this.setController_MathButton(core);context.math.mathController=math_controller,context.math._mathExp=null,math_dialog.querySelector("form").addEventListener("submit",this.submit.bind(core),!1),math_controller.addEventListener("click",this.onClick_mathController.bind(core)),context.math.previewElement.style.fontSize=context.math.defaultFontSize,context.dialog.modal.appendChild(math_dialog),context.element.relative.appendChild(math_controller),math_dialog=null,math_controller=null},setDialog:function(core){const lang=core.lang,dialog=core.util.createElement("DIV"),fontSize=core.options.mathFontSize;let defaultFontSize=fontSize[0].value;dialog.className="se-dialog-content",dialog.style.display="none";let html='<form><div class="se-dialog-header"><button type="button" data-command="close" class="se-btn se-dialog-close" title="'+lang.dialogBox.close+'" aria-label="'+lang.dialogBox.close+'">'+core.icons.cancel+'</button><span class="se-modal-title">'+lang.dialogBox.mathBox.title+'</span></div><div class="se-dialog-body"><div class="se-dialog-form"><label>'+lang.dialogBox.mathBox.inputLabel+' (<a href="https://katex.org/docs/supported.html" target="_blank">KaTeX</a>)</label><textarea class="se-input-form se-math-exp" type="text"></textarea></div><div class="se-dialog-form"><label>'+lang.dialogBox.mathBox.fontSizeLabel+'</label><select class="se-input-select se-math-size">';for(let f,i=0,len=fontSize.length;i<len;i++)f=fontSize[i],f.default&&(defaultFontSize=f.value),html+='<option value="'+f.value+'"'+(f.default?" selected":"")+">"+f.text+"</option>";return html+='</select></div><div class="se-dialog-form"><label>'+lang.dialogBox.mathBox.previewLabel+'</label><p class="se-math-preview"></p></div></div><div class="se-dialog-footer"><button type="submit" class="se-btn-primary" title="'+lang.dialogBox.submitButton+'" aria-label="'+lang.dialogBox.submitButton+'"><span>'+lang.dialogBox.submitButton+"</span></button></div></form>",core.context.math.defaultFontSize=defaultFontSize,dialog.innerHTML=html,dialog},setController_MathButton:function(core){const lang=core.lang,math_btn=core.util.createElement("DIV");return math_btn.className="se-controller se-controller-link",math_btn.innerHTML='<div class="se-arrow se-arrow-up"></div><div class="link-content"><div class="se-btn-group"><button type="button" data-command="update" tabindex="-1" class="se-btn se-tooltip">'+core.icons.edit+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.edit+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="se-btn se-tooltip">'+core.icons.delete+'<span class="se-tooltip-inner"><span class="se-tooltip-text">'+lang.controller.remove+"</span></span></button></div></div>",math_btn},open:function(){this.plugins.dialog.open.call(this,"math","math"===this.currentControllerName)},managedTags:function(){return{className:"katex",method:function(element){if(!element.getAttribute("data-exp")||!this.options.katex)return;const dom=this._d.createRange().createContextualFragment(this.plugins.math._renderer.call(this,this.util.HTMLDecoder(element.getAttribute("data-exp"))));element.innerHTML=dom.querySelector(".katex").innerHTML}}},_renderer:function(exp){let result="";try{this.util.removeClass(this.context.math.focusElement,"se-error"),result=this.options.katex.src.renderToString(exp,{throwOnError:!0,displayMode:!0})}catch(error){this.util.addClass(this.context.math.focusElement,"se-error"),result='<span class="se-math-katex-error">Katex syntax error. (Refer <a href="https://katex.org/docs/supported.html" target="_blank">KaTeX</a>)</span>',console.warn("[SUNEDITOR.math.Katex.error] ",error)}return result},_renderMathExp:function(contextMath,e){contextMath.previewElement.innerHTML=this.plugins.math._renderer.call(this,e.target.value)},submit:function(e){this.showLoading(),e.preventDefault(),e.stopPropagation();const submitAction=function(){if(0===this.context.math.focusElement.value.trim().length)return!1;const contextMath=this.context.math,mathExp=contextMath.focusElement.value,katexEl=contextMath.previewElement.querySelector(".katex");if(!katexEl)return!1;if(katexEl.className="__se__katex "+katexEl.className,katexEl.setAttribute("contenteditable",!1),katexEl.setAttribute("data-exp",this.util.HTMLEncoder(mathExp)),katexEl.setAttribute("data-font-size",contextMath.fontSizeElement.value),katexEl.style.fontSize=contextMath.fontSizeElement.value,this.context.dialog.updateModal){const containerEl=this.util.getParentElement(contextMath._mathExp,".katex");containerEl.parentNode.replaceChild(katexEl,containerEl),this.setRange(katexEl,0,katexEl,1)}else{const selectedFormats=this.getSelectedElements();if(selectedFormats.length>1){const oFormat=this.util.createElement(selectedFormats[0].nodeName);if(oFormat.appendChild(katexEl),!this.insertNode(oFormat,null,!0))return!1}else if(!this.insertNode(katexEl,null,!0))return!1;const empty=this.util.createTextNode(this.util.zeroWidthSpace);katexEl.parentNode.insertBefore(empty,katexEl.nextSibling),this.setRange(katexEl,0,katexEl,1)}return contextMath.focusElement.value="",contextMath.fontSizeElement.value="1em",contextMath.previewElement.style.fontSize="1em",contextMath.previewElement.innerHTML="",!0}.bind(this);try{submitAction()&&(this.plugins.dialog.close.call(this),this.history.push(!1))}catch(e){this.plugins.dialog.close.call(this)}finally{this.closeLoading()}return!1},active:function(element){if(element){if(element.getAttribute("data-exp"))return this.controllerArray.indexOf(this.context.math.mathController)<0&&(this.setRange(element,0,element,1),this.plugins.math.call_controller.call(this,element)),!0}else this.controllerArray.indexOf(this.context.math.mathController)>-1&&this.controllersOff();return!1},on:function(update){if(update){const contextMath=this.context.math;if(contextMath._mathExp){const exp=this.util.HTMLDecoder(contextMath._mathExp.getAttribute("data-exp")),fontSize=contextMath._mathExp.getAttribute("data-font-size")||"1em";this.context.dialog.updateModal=!0,contextMath.focusElement.value=exp,contextMath.fontSizeElement.value=fontSize,contextMath.previewElement.innerHTML=this.plugins.math._renderer.call(this,exp),contextMath.previewElement.style.fontSize=fontSize}}else this.plugins.math.init.call(this)},call_controller:function(mathTag){this.context.math._mathExp=mathTag;const mathBtn=this.context.math.mathController;this.setControllerPosition(mathBtn,mathTag,"bottom",{left:0,top:0}),this.controllersOn(mathBtn,mathTag,"math")},onClick_mathController:function(e){e.stopPropagation();const command=e.target.getAttribute("data-command")||e.target.parentNode.getAttribute("data-command");command&&(e.preventDefault(),/update/.test(command)?(this.context.math.focusElement.value=this.util.HTMLDecoder(this.context.math._mathExp.getAttribute("data-exp")),this.plugins.dialog.open.call(this,"math",!0)):(this.util.removeItem(this.context.math._mathExp),this.context.math._mathExp=null,this.focus(),this.history.push(!1)),this.controllersOff())},init:function(){const contextMath=this.context.math;contextMath.mathController.style.display="none",contextMath._mathExp=null,contextMath.focusElement.value="",contextMath.previewElement.innerHTML=""}};var fileBrowser=__webpack_require__("./node_modules/suneditor/src/plugins/modules/fileBrowser.js"),fileBrowser_default=__webpack_require__.n(fileBrowser);const imageGallery={name:"imageGallery",add:function(core){core.addModule([fileBrowser_default()]);core.context.imageGallery={title:core.lang.toolbar.imageGallery,url:core.options.imageGalleryUrl,header:core.options.imageGalleryHeader,listClass:"se-image-list",itemTemplateHandler:this.drawItems,selectorHandler:this.setImage.bind(core),columnSize:4}},open:function(selectorHandler){this.plugins.fileBrowser.open.call(this,"imageGallery",selectorHandler)},drawItems:function(item){const srcName=item.src.split("/").pop();return'<div class="se-file-item-img"><img src="'+(item.thumbnail||item.src)+'" alt="'+(item.alt||srcName)+'" data-command="pick" data-value="'+(item.src||item.thumbnail)+'"><div class="se-file-img-name se-file-name-back"></div><div class="se-file-img-name __se__img_name">'+(item.name||srcName)+"</div></div>"},setImage:function(target){this.callPlugin("image",function(){const file={name:target.parentNode.querySelector(".__se__img_name").textContent,size:0};this.plugins.image.create_image.call(this,target.getAttribute("data-value"),null,this.context.image._origin_w,this.context.image._origin_h,"none",file,target.alt)}.bind(this),null)}},plugins={blockquote,align:align.Z,font:font.Z,fontSize:fontSize.Z,fontColor:fontColor.Z,hiliteColor:hiliteColor.Z,horizontalRule:horizontalRule.Z,list:list.Z,table:table.Z,formatBlock:formatBlock.Z,lineHeight:lineHeight.Z,template:template.Z,paragraphStyle:paragraphStyle.Z,textStyle:textStyle.Z,link:dialog_link.Z,image:dialog_image.Z,video,audio,math,imageGallery}}}]);